<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发文档-2 | Leetcode-runner</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/leetcode-runner-doc/img/logo/leetcode-runner-v1.png">
    <meta name="description" content="为摸鱼而生">
    <meta name="keywords" content="leetcode,Leetcode-runner,力扣">
    <meta name="theme-color" content="#11a8cd">
    <meta id="referrer" name="referrer" content="never">
    
    <link rel="preload" href="/leetcode-runner-doc/assets/css/0.styles.45dc8e91.css" as="style"><link rel="preload" href="/leetcode-runner-doc/assets/js/app.b2405ffb.js" as="script"><link rel="preload" href="/leetcode-runner-doc/assets/js/2.0d2480f6.js" as="script"><link rel="preload" href="/leetcode-runner-doc/assets/js/10.85f9f940.js" as="script"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/11.af12cb65.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/12.69582d1c.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/13.62c37132.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/14.c2188b10.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/15.fe0af28f.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/16.34a0fe97.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/17.3bc3927d.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/18.e45b10f3.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/19.023d941f.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/20.7ad48c9a.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/3.06a8f99a.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/4.15d5af9b.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/5.2eb752c5.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/6.d585a137.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/7.144b0437.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/8.6ec1a706.js"><link rel="prefetch" href="/leetcode-runner-doc/assets/js/9.f05246ec.js">
    <link rel="stylesheet" href="/leetcode-runner-doc/assets/css/0.styles.45dc8e91.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/leetcode-runner-doc/" class="home-link router-link-active"><img src="/leetcode-runner-doc/img/logo/leetcode-runner-v1.png" alt="Leetcode-runner" class="logo"> <span class="site-name can-hide">Leetcode-runner</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/leetcode-runner-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/leetcode-runner-doc/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/a2f161/" class="nav-link">简 介</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/2f674a/" class="nav-link">安 装</a></li><li class="dropdown-item"><h4>开 始</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/793dcb/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/a20ce8/" class="nav-link">使用配置</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/98u9hk/" class="nav-link">辅助功能</a></li></ul></li><li class="dropdown-item"><h4>更新日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/ojodioj/" class="nav-link">v3.6.9</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/leetcode-runner-doc/pages/a20ce8/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/e88d84d/" class="nav-link">开发文档-1</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/yih7ij/" aria-current="page" class="nav-link router-link-exact-active router-link-active">开发文档-2</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/yih7ij/404" class="nav-link">调试引擎</a></li><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/0x3f/" class="nav-link">API入门</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/7f76b7/" class="nav-link">算法模板</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/leetcode-runner-doc/pages/9cc27d/" class="nav-link">问答</a></div> <a href="https://github.com/xuhuafeifei/leetcode-runner" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/leetcode-runner-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/leetcode-runner-doc/pages/a2f161/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/a2f161/" class="nav-link">简 介</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/2f674a/" class="nav-link">安 装</a></li><li class="dropdown-item"><h4>开 始</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/793dcb/" class="nav-link">快速上手</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/a20ce8/" class="nav-link">使用配置</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/98u9hk/" class="nav-link">辅助功能</a></li></ul></li><li class="dropdown-item"><h4>更新日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/ojodioj/" class="nav-link">v3.6.9</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><a href="/leetcode-runner-doc/pages/a20ce8/" class="link-title">教程</a> <span class="title" style="display:none;">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/e88d84d/" class="nav-link">开发文档-1</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/yih7ij/" aria-current="page" class="nav-link router-link-exact-active router-link-active">开发文档-2</a></li><li class="dropdown-item"><!----> <a href="/leetcode-runner-doc/pages/yih7ij/404" class="nav-link">调试引擎</a></li><li class="dropdown-item"><h4>算法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/0x3f/" class="nav-link">API入门</a></li><li class="dropdown-subitem"><a href="/leetcode-runner-doc/pages/7f76b7/" class="nav-link">算法模板</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/leetcode-runner-doc/pages/9cc27d/" class="nav-link">问答</a></div> <a href="https://github.com/xuhuafeifei/leetcode-runner" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>源码讲解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/leetcode-runner-doc/pages/e88d84d/" class="sidebar-link">开发文档-1</a></li><li><a href="/leetcode-runner-doc/pages/yih7ij/" aria-current="page" class="active sidebar-link">开发文档-2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#搜索功能" class="sidebar-link">搜索功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#模块整体设计" class="sidebar-link">模块整体设计</a></li><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#数据管理模块" class="sidebar-link">数据管理模块</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#sourcemanager" class="sidebar-link">SourceManager</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#sourcebuffer" class="sidebar-link">SourceBuffer</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#iteratoradvance" class="sidebar-link">IteratorAdvance</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#captureiterator" class="sidebar-link">CaptureIterator</a></li><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#分词处理" class="sidebar-link">分词处理</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#segmentation" class="sidebar-link">Segmentation</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#context" class="sidebar-link">Context</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#processorfactory" class="sidebar-link">ProcessorFactory</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#enprocessor" class="sidebar-link">ENProcessor</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#digitprocessor" class="sidebar-link">DigitProcessor</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#nonprocessor" class="sidebar-link">NonProcessor</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#cnprocessor" class="sidebar-link">CNProcessor</a></li><li class="sidebar-sub-header level4"><a href="/leetcode-runner-doc/pages/yih7ij/#dicttree" class="sidebar-link">DictTree</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#事件总线" class="sidebar-link">事件总线</a></li><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#整体架构" class="sidebar-link">整体架构</a></li><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#java调试服务" class="sidebar-link">Java调试服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#_1-执行流程" class="sidebar-link">1.执行流程</a></li><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#_2-死锁" class="sidebar-link">2.死锁</a></li><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#_3-并发问题" class="sidebar-link">3. 并发问题</a></li><li class="sidebar-sub-header level3"><a href="/leetcode-runner-doc/pages/yih7ij/#_4-表达式计算" class="sidebar-link">4. 表达式计算</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#python调试服务" class="sidebar-link">Python调试服务</a></li><li class="sidebar-sub-header level2"><a href="/leetcode-runner-doc/pages/yih7ij/#cpp调试服务" class="sidebar-link">Cpp调试服务</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>算法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/leetcode-runner-doc/pages/0x3f/" class="sidebar-link">API入门</a></li><li><a href="/leetcode-runner-doc/pages/7f76b7/" class="sidebar-link">算法模板</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-057748f7><div class="articleInfo" data-v-057748f7><ul class="breadcrumbs" data-v-057748f7><li data-v-057748f7><a href="/leetcode-runner-doc/" title="首页" class="iconfont icon-home router-link-active" data-v-057748f7></a></li> <li data-v-057748f7><span data-v-057748f7>教程</span></li><li data-v-057748f7><span data-v-057748f7>源码讲解</span></li></ul> <div class="info" data-v-057748f7><div title="作者" class="author iconfont icon-touxiang" data-v-057748f7><a href="https://github.com/itxaiohanglover" target="_blank" title="作者" class="beLink" data-v-057748f7>文艺倾年</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-057748f7><a href="javascript:;" data-v-057748f7>2025-04-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">开发文档-2<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="v2-6【大更新】"><a href="#v2-6【大更新】" class="header-anchor">#</a> V2.6【大更新】</h1> <p>更新点主要有</p> <ol><li>搜索功能</li> <li>事件总线</li></ol> <h2 id="搜索功能"><a href="#搜索功能" class="header-anchor">#</a> 搜索功能</h2> <p>搜索功能对外提供问题搜索能力，其原理是基于Lucence开发中文文本分析器，将文本分析结果输入Lucence后，构建倒排索引，从而加快搜索能力，下图则是搜索模块实现的功能预览图</p> <p><img src="https://i-blog.csdnimg.cn/direct/c4e053752b57488a8b1dd81fc71e5261.gif" alt="请添加图片描述"></p> <p>有关更详细的信息，可以参考笔者的这篇文章：<a href="https://blog.csdn.net/qq_62835094/article/details/144428011?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">基于Lucence开发一个中文分析器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>有关搜索功能的相关代码，都存放在search包下</p> <p>下面通过gif的方式介绍中文分析器的整体工作流程
<img src="https://i-blog.csdnimg.cn/direct/5b57a8fe42aa43908b1b4eb42d6c259c.gif" alt="请添加图片描述"></p> <ul><li>step1：数据管理模块加载分段数据</li> <li>step2：分词处理器迭代处理分段数据</li> <li>step3：分段数据处理完成，跳转至step1</li> <li>step4：所有数据加载完毕，终止处理</li></ul> <p>通过上图我们可以发现，整个处理流程可以划分为两个模块</p> <ol><li>数据管理模块</li> <li>分词处理模块</li></ol> <h3 id="模块整体设计"><a href="#模块整体设计" class="header-anchor">#</a> 模块整体设计</h3> <p>下图为笔者的模块设计图
 <img src="/leetcode-runner-doc/assets/img/22.d0980ef7.jpg"></p> <h3 id="数据管理模块"><a href="#数据管理模块" class="header-anchor">#</a> 数据管理模块</h3> <h4 id="sourcemanager"><a href="#sourcemanager" class="header-anchor">#</a> SourceManager</h4> <p>SourceManager（简称SM），负责维护数据源source，同时管理分段数据SourceBuffer（简称SB）。对外通过迭代器，提供底层数据的访问</p> <p>SM封装了底层对于数据的管理，当迭代到分段数据的边界时，会自动进行分段数据的加载。为了实现这一功能，SM封装了两个迭代器，<code>IteratorAdvance</code>和<code>CaptureIterator</code>。</p> <h4 id="sourcebuffer"><a href="#sourcebuffer" class="header-anchor">#</a> SourceBuffer</h4> <p>SourceBuffer，维护分段数据，SM从soure中读取的分段数据会写入SB，SB内部维护迭代器<code>Itr</code>，通过Itr的迭代来对外提供底层数据的访问。需要注意的是，凡是被Itr迭代过的数据，都会被SB视为<strong>已消费</strong>，<strong>被消费过的数据不会被重复访问</strong></p> <h4 id="iteratoradvance"><a href="#iteratoradvance" class="header-anchor">#</a> IteratorAdvance</h4> <p><code>IteratorAdvance</code>增强迭代器（简称ItrAdv），是对SB的<code>Itr</code>的增强。ItrAdv和Itr共同继承<code>com.xhf.leetcode.plugin.search.Iterator</code>接口，拥有迭代数据的能力。但ItrAdv本身并不能对SB的数据进行迭代。ItrAdv通过持有Itr，使用Itr来间接迭代SB。<strong>如果ItrAdv发现SB数据被迭代完后，ItrAdv会自动加载分段数据</strong>，从而屏蔽消费者对分段数据的感知。ItrAdv的增强设计参考了Spring的Aop，可以认为ItrAdv对Itr的增强属于AOP的环绕增强，只不过AOP运用的是反射机制，ItrAdv使用的是组合模式</p> <h4 id="captureiterator"><a href="#captureiterator" class="header-anchor">#</a> CaptureIterator</h4> <p><code>CaptureIterator</code>快照迭代器（简称CI），是为了应对中文分词处理边界数据遇到的问题而引入的解决方案，CI迭代到边界数据时会触发<code>SM的预加载机制</code>，配合PreBuffer避免影响底层的SB数据。</p> <p>有关CI引入的详细原因，<code>SM的预加载机制</code>等细节，可参考项目代码中的注释信息，本文从宏观的角度做出整体介绍</p> <p>所谓快照迭代器，顾名思义，是对底层SB维护的Itr的一种快照。通过拍摄快照的形式，CI允许消费者获取SB数据的同时，不会真正消费SB内部的数据。当CI迭代到SB维护分段数据的边界时，会自动加载数据。<strong>如果数据写入SB，则SB内未被真正消费的数据会被覆盖</strong>，因此引入<code>预加载机制</code>。所谓预加载机制，就是将数据写入<strong>PreBuffer</strong>内，从而避免对底层数据造成修改</p> <p><img src="https://i-blog.csdnimg.cn/direct/c55b0eea4a6547b9a21a2b12f82df9bf.gif" alt="请添加图片描述"></p> <p>引入PreBuffer可以避免CI对底层数据的加载，但PreBuffer的出现会导致source内部的指针偏移，提前将SB要加载source的那部分数据加载完。因此在后续迭代的过程中，SM需要协调PreBuffer，SB，source三者之间的数据流转的问题</p> <h3 id="分词处理"><a href="#分词处理" class="header-anchor">#</a> 分词处理</h3> <h4 id="segmentation"><a href="#segmentation" class="header-anchor">#</a> Segmentation</h4> <p>分词器，本身不负责分词，通过调用Processor对外提供分词能力。可以说<code>Segmentation</code>是个中转站，本身不具备各种能力。但他内部维护各种类，通过协调各个类之间的关系，从而对外提供分词能力</p> <h4 id="context"><a href="#context" class="header-anchor">#</a> Context</h4> <p>context，上下文对象，简称ctx。ctx内部存储分词处理过程中的上下文数据。下方为ctx的源码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SourceManager</span> sm<span class="token punctuation">;</span>
    <span class="token comment">// 当前处理的字符</span>
    <span class="token keyword">private</span> <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token comment">// 迭代器</span>
    <span class="token keyword">private</span> <span class="token class-name">Iterator</span> iterator<span class="token punctuation">;</span>
    <span class="token comment">// tokens</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Token</span><span class="token punctuation">&gt;</span></span> tokens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Token</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前文本处理得到的token</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span>
    <span class="token comment">// 当前处理的字符长度(等于处理的字符次数)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>需要注意的是，ctx内部采用队列维护Token。这种数据结构允许<strong>Processor在单轮处理中，产生多个合法Token</strong></p> <h4 id="processorfactory"><a href="#processorfactory" class="header-anchor">#</a> ProcessorFactory</h4> <p>工厂，简称PF，通过工厂模式屏蔽创建实现类的复杂度。该工厂通过当前迭代的字符类型，判断需要创建何种处理器(Processor)</p> <h4 id="enprocessor"><a href="#enprocessor" class="header-anchor">#</a> ENProcessor</h4> <p>字母处理器，专门负责处理字母分词。其内部处理逻辑为，以字符c为开始，尽可能匹配长的字母。</p> <p>比如遇到如下数据<code>['h', 'e', 'l', 'l', 'o', '2', '3']</code>，加入当前处理到的字符c为'h'，那么ENP会尽可能长的将以'h'开头的字符组成的EN_Token全部匹配，最终返回EN_Token是&quot;hello&quot;，遇到'2'后终止匹配</p> <h4 id="digitprocessor"><a href="#digitprocessor" class="header-anchor">#</a> DigitProcessor</h4> <p>数字处理器，专门负责处理数字。其原理和ENProcessor类似，都是尽可能长的匹配数字，当遇到无法组成数字的字符时，终止匹配</p> <h4 id="nonprocessor"><a href="#nonprocessor" class="header-anchor">#</a> NonProcessor</h4> <p>未知处理器，该处理器有些特殊，专门负责那些无法识别的字符。下方是该类的源码，当遇到无法处理的字符时，NonP会持续迭代数据，直到遇到能够被PF识别的字符</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NonProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">Processor</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 当前processor处理无法识别的内容. 处理逻辑为持续迭代context数据, 直到迭代出能够识别的字符, 如果没有额外数据, 则会终止迭代
     * @param context
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doProcess</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ProcessorFactory</span> pf <span class="token operator">=</span> <span class="token class-name">ProcessorFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">nextC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Processor</span> processor <span class="token operator">=</span> pf<span class="token punctuation">.</span><span class="token function">createProcessor</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 如果下一个字符数据能被工厂识别, 则进行处理</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token punctuation">(</span>processor <span class="token keyword">instanceof</span> <span class="token class-name">NonProcessor</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                processor<span class="token punctuation">.</span><span class="token function">doProcess</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 完成处理, 终止运行</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="cnprocessor"><a href="#cnprocessor" class="header-anchor">#</a> CNProcessor</h4> <p>专门处理中文的处理器，采用<code>最长匹配 + 最细粒度匹配</code>。</p> <p>CNProcessor会以每一个中文字符为start, 尝试以该字符为start, 匹配出最长的词组CN_Token。如果匹配得到的CN_Token长度大于1, 则同时将start作为单独的Token进行存储</p> <p>比如[两, 数]: 以'两'为start可以匹配出的最长Token是'两数'. 两数的长度为2, 所以CNProcessor会存储'两数', '两'这两个Token</p> <p>其内部通过<code>DictTree</code>来判断字符能否组成CN_Token。</p> <h4 id="dicttree"><a href="#dicttree" class="header-anchor">#</a> DictTree</h4> <p>DictTree，简称DT，字典树。通过树形结构维护词组数据，最终产生形如下方的多叉树</p> <p><img src="https://i-blog.csdnimg.cn/direct/64635209a5ab4abe97451d3f8152d451.png" alt="在这里插入图片描述">
每一个字符最为树的节点，并且拥有若干个后记节点。除此以外，每个节点都表示当前字符是否能够成为已有词组的最后一个字符</p> <p>比如说&quot;天天开心&quot;的'心'字，他就能成为最后一个字符。但第二个'天'字，就不行。CNP就是通过判断匹配的字符<strong>能否成为结尾来判断是否能组成合法CN_Token</strong></p> <h2 id="事件总线"><a href="#事件总线" class="header-anchor">#</a> 事件总线</h2> <p>废弃原本的设计方式，直接使用guava包的EventBus。</p> <p>另外，项目中引入了更多的事件，将原本耦合的模块彻底解耦</p> <h1 id="v3-5-0【大更新】"><a href="#v3-5-0【大更新】" class="header-anchor">#</a> V3.5.0【大更新】</h1> <ul><li>Debug服务：支持leetcode核心代码的调试，无需用户做出任何更改，风格类似idea的debug风格
<ul><li>Java Debug服务</li> <li>Python Debug服务</li> <li>C++ Debug服务</li></ul></li></ul> <p>Debug服务内容很多，本文仅从宏观的角度做出介绍，有关debug服务的详细介绍，可以参考我写的五篇文章+源码注释</p> <p><a href="https://blog.csdn.net/qq_62835094/article/details/145147759?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》如何手搓一个debug调试器——引言<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_62835094/article/details/145148269?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】【源码】如何手搓一个debug调试器——架构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_62835094/article/details/145158203?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》如何手搓一个debug调试器——指令系统<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_62835094/article/details/145159294?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】如何手搓一个debug调试器——调试程序【JDI开发】【万字详解】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_62835094/article/details/145180305?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】【源码】如何手搓一个debug调试器——表达式计算<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>tip: 以上五篇文章仅仅介绍Java Debug服务+整个架构的引入+可复用的内容介绍。Python，C++的将在本文介绍</p></blockquote> <h2 id="整体架构"><a href="#整体架构" class="header-anchor">#</a> 整体架构</h2> <img src="/leetcode-runner-doc/assets/img/debug-jiagou-xiuzheng.1ff73012.jpg" alt="debug-jiagou-xiuzheng" style="zoom:50%;"> <p>Debugger是所有debug框架的启动核心类，其中封装了所有的debug逻辑</p> <p>DebugEnv是环境对象，用于构建Debug所需要的环境</p> <p>Instruction代表debug框架的指令体系，每条指令对应着不同的执行逻辑</p> <p>InstReader、InstExecutor、Output是整个debug流程的核心。分别负责<code>读取指令</code>, <code>执行指令</code>, <code>输出执行结果</code></p> <p>其中<code>InstExecutor</code>负责和<strong>核心的调试服务</strong>沟通，<code>ExecutorContent</code>是上下文对象，用于沟通执行器和调试服务。同时，上下文对象还能够沟通不同的<strong>指令执行器</strong></p> <p>调试服务，是整个框架最为核心的部分，它封装底层不同语言提供的调适能力，并进行代码控制，与Java插件进行交互</p> <p>当前所有语言的Debug调试器均基于上述架构，后续如果需要新增不同语言的调试器，只要<code>调试服务</code>可以实现，那么这个语言就<strong>具备接入Leetcode-runner</strong>的能力</p> <h2 id="java调试服务"><a href="#java调试服务" class="header-anchor">#</a> Java调试服务</h2> <h3 id="_1-执行流程"><a href="#_1-执行流程" class="header-anchor">#</a> 1.执行流程</h3> <p>Java的debug调试，核心借助JDI提供的各种接口，来实现对底层JVM的控制</p> <p>有关JDI提供的接口内容，可自行查阅文档，或者阅读我的这篇文章——<a href="https://blog.csdn.net/qq_62835094/article/details/145159294?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】如何手搓一个debug调试器——调试程序【JDI开发】【万字详解】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>JavaDebugger采用<strong>多线程的方式处理</strong>，其中<code>JavaDebugger</code>负责和用户交互，<code>JEventHandler</code>负责和<strong>Debug的JVM</strong>交互</p> <p>其具体的执行流程可以用下图表示</p> <p>其中JavaDebugger、JEvenHandler分别属于不同的线程</p> <img src="/leetcode-runner-doc/assets/img/liucheng-tu.3b14abc2.jpg" alt="liucheng-tu" style="zoom:25%;"> <p>之所以采用多线程，是为了<strong>避免死锁的出现</strong>，有关死锁发生的场景，将会在后文介绍</p> <h3 id="_2-死锁"><a href="#_2-死锁" class="header-anchor">#</a> 2.死锁</h3> <p>死锁会发生在如下场景</p> <p>假设只有单线程，那么如下情况会发生死锁</p> <ol><li>JavaDebugger调用<code>Value.invokeMethod</code>，阻塞等待执行结果，同时TargetVM恢复运行</li> <li>TargetVM运行时会产生Event返回，交由JavaDebugger捕获</li> <li>TargetVM执行产生一次Event后会暂停线程，等待被JavaDebugger放行</li> <li>JavaDebugger依赖于TargetVM返回结果，TargetVM想返回结果，依赖于JavaDebugger放行（恢复线程），因此发生死锁</li></ol> <p>如果引入多线程，那么TargetVM依赖于JEventHandler放行，自然就不会出现死锁问题</p> <p>不过需要注意的是，JEventHandler争对<code>Value.invokeMethod</code>需要做出特殊判断</p> <p><code>Value.invokeMethod</code>方法会要求TargetVM重新执行一次方法，在此期间会产生大量的<strong>Step Event</strong>（单步执行事件）</p> <p>JEventHandler捕获<strong>Step Event</strong>，默认不会放行，这适用于绝大多数情况。但如果<strong>JavaDebugger</strong>执行<code>Value.invokeMethod</code>，则需要放行，否则TargetVM无法计算得到结果</p> <h3 id="_3-并发问题"><a href="#_3-并发问题" class="header-anchor">#</a> 3. 并发问题</h3> <p>因为多线程的引入，自然而然的会导致并发问题。具体来说，前台JavaDebugger在使用<strong>Context</strong>的数据时，后台<strong>JEventHandler</strong>线程对其进行更改，导致前台执行得到错误的数据</p> <p>为了解决这一问题，在<strong>Context</strong>中引入协调器的概念</p> <p>之所以产生并发问题，本质上是因为前台执行时，后台也在执行。而协调器的引入，则让JavaDebugger等待JEventHandler稳定后，再使用Context的数据并计算，从而避免后台线程更改数据时执行计算</p> <h3 id="_4-表达式计算"><a href="#_4-表达式计算" class="header-anchor">#</a> 4. 表达式计算</h3> <p>表达式计算，允许用户在debug过程中监控某些变量，或者对变量进行额外操作，或者调用方法提前计算</p> <p>在JavaDebugger中，JDI底层<strong>并没有</strong>提供相应的计算功能，因此表达式计算功能是由Leetcode-runner实现。</p> <p>有关表达式计算的详细内容，可以阅读我的这篇文章<a href="https://blog.csdn.net/qq_62835094/article/details/145180305?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】【源码】如何手搓一个debug调试器——表达式计算<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在Leetcode-runner中，表达式被分为以下几种类型</p> <ul><li>纯变量（如a，b，c这种单纯变量）</li> <li>数组（如arr[0]）</li> <li>表达式计算（如1+2，a+b这种）</li> <li>实例方法调用（如demo.invoke()）</li> <li>纯方法调用（ dfs()，takeLocalValue(a) ）</li> <li>纯常量（如1，3.14，“nihao”， ‘&amp;’）</li> <li>运算符（如+,-,*,/,&lt;&lt;,&amp;等）</li></ul> <p>每种类型的表达式都会被对应的<strong>对象封装</strong>，同时对外提供统计的接口，用于提供计算结果，在Leetcode-runner种，<strong>Token封装表达式内容+表达式计算功能</strong></p> <p><strong>TokenFactory负责识别表达式并返回Token</strong>，而TokenFactory的识别依赖于内部封装的<strong>Rule</strong></p> <p><strong>Rule</strong>封装了表达式的识别逻辑，不同的Rule对应不同的Token，且只对应一个</p> <p>对于复杂的表达式，可以通过TokenFactory解析得到Token，Token内部再通过TokenFactory递归解析，逐步拆解复杂表达式，将其拆分为若干简单表达式的组合，最终计算得到结果</p> <p><strong>架构图：</strong></p> <img src="/leetcode-runner-doc/assets/img/biaodashi.164ac536.jpg" alt="biaodashi-jiagou-2"> <p>上述架构以及对应的功能已经能够解决计算绝大多数复杂的表达式，诸如<code>arr[b.invoke(1 + 2, c, arr2[0])] + dfs(1,2,c.invoke())</code></p> <p>它就可以按照如下规则拆分：</p> <p>在计算表达式当中，存在一个数组表达式<code>arr[...]</code>，和纯函数调用表达式<code>dfs(...)</code></p> <p>在数组的维度信息中，存在一个<code>方法调用表达式——a.invoke(...)</code>。方法调用的内部，又可以拆分为<code>计算表达式1+2</code>，<code>纯变量表达式c</code>，<code>数组表达式arr2[0]</code></p> <p>在纯函数调用的括号内，存在两个<code>纯常量表达式——1，2</code>，存在一个<code>方法调用表达式c.invoke()</code></p> <p>尽管计算框架依然具备很强的计算逻辑，但它对于链式调用的Token依然束手无策，如<code>a.invoke().c[0][1]</code></p> <p>因此，再最新版本种，引入了链式调用这一概念——<code>TokenChain</code></p> <p>在leetcode-runner中，额外引入<strong>TokenChain</strong>，<strong>RuleChain</strong>。专门处理链式的计算</p> <p>有关链式调用的详细介绍，可以参考我的这篇文章——<a href="https://blog.csdn.net/qq_62835094/article/details/145180305?spm=1001.2014.3001.5502" target="_blank" rel="noopener noreferrer">《leetcode-runner》【图解】【源码】如何手搓一个debug调试器——表达式计算<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="python调试服务"><a href="#python调试服务" class="header-anchor">#</a> Python调试服务</h2> <p>因为python和Java分属于不同语言，无法再同一个进程内运行，因此采用web的方式沟通</p> <p><strong>架构图：</strong></p> <img src="/leetcode-runner-doc/assets/img/leetcode-runner.d3059b0c.jpg" alt="leetcode-runner"> <p>后续的C++Debug服务，整体架构类似于python，往后只要是需要接入Leetcode-runner的调试器，基本都会遵循如上架构</p> <p>python的debug功能，主要基于<code>sys.settrace</code>方法，该方法会在python解释一行代码后，自动调用传入的回调函数。而所有的debug逻辑都写在回调函数内</p> <p>另外，python内置的eval函数就具备表达式计算的功能，无需手动实现</p> <h2 id="cpp调试服务"><a href="#cpp调试服务" class="header-anchor">#</a> Cpp调试服务</h2> <p>Cpp调试服务，底层debug能力是由GDB提供。GDB的MI模式，会返回格式化数据，方便开发者解析</p> <p>但是GDB并不能直接嵌入Leetcode-runner，因为它存在一个致命的缺陷——读取、输出都是工作在终端</p> <p>GDB从标准输入读取数据，然后在标准输出显示数据，但在leetcode-runner中，不存在终端。这也是为什么Java、Python等debug服务都没有封装已有的调试器</p> <p>但C++不同，C++具有<strong>管道、重定向</strong>等逆天功能，它可以手动控制GDB的输入输出，使其嵌入项目当中</p> <img src="/leetcode-runner-doc/assets/img/cpp-jiagou.61ee93df.jpg" alt="cpp-jiagou" style="zoom:33%;"> <p>对于GDB-MI模式下输出的内容，全部交由<strong>JavaDebugger</strong>解析</p> <p>解析工作由<strong>GdbParser负责</strong>，整套GDB解析学习了Gson的设计方式，整体不算复杂，但还是挺有意思的，更详细的内容请参考源码</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/itxaiohanglover/leetcode-runner-doc/edit/master/docs/02.教程/01.源码讲解/02.开发文档-2.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/04/02, 14:09:35</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/leetcode-runner-doc/pages/e88d84d/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">开发文档-1</div></a> <a href="/leetcode-runner-doc/pages/0x3f/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">API入门</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/leetcode-runner-doc/pages/e88d84d/" class="prev">开发文档-1</a></span> <span class="next"><a href="/leetcode-runner-doc/pages/0x3f/">API入门</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/itxaiohanglover" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://github.com/xuhuafeifei" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2025-2025
    <span>文艺倾年 | 飞哥不鸽</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/leetcode-runner-doc/assets/js/app.b2405ffb.js" defer></script><script src="/leetcode-runner-doc/assets/js/2.0d2480f6.js" defer></script><script src="/leetcode-runner-doc/assets/js/10.85f9f940.js" defer></script>
  </body>
</html>
